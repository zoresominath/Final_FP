{% extends "base.html" %}

{% block sidebar %}{% endblock %}

{% block content %}
<style>
    /* Yellow/Gold Title Style */
    .mess-title-gradient {
        background: -webkit-linear-gradient(45deg, #FFD700, #ff8c00);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        font-family: 'Lobster', cursive;
        font-size: 2rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }
    
    /* Profile Header Card */
    .profile-header {
        background: linear-gradient(135deg, #0d6efd, #0a58ca);
        color: white;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
    }
    .profile-header::after {
        content: '';
        position: absolute;
        top: -50px; right: -50px;
        width: 150px; height: 150px;
        background: rgba(255,255,255,0.1);
        border-radius: 50%;
    }
    .user-avatar-large {
        width: 100px; height: 100px;
        border-radius: 50%;
        border: 4px solid rgba(255,255,255,0.3);
        object-fit: cover;
    }
</style>

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="mess-title-gradient mb-0">User Details</h3>
        <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back to Dashboard
        </a>
    </div>

    <div class="profile-header shadow">
        <div class="d-flex align-items-center flex-wrap gap-4">
            <div>
                {% if u.image_filename %}
                    <img src="{{ url_for('static', filename='profile_pics/' + u.image_filename) if 'http' not in u.image_filename else u.image_filename }}" class="user-avatar-large" alt="Profile">
                {% else %}
                    <img src="https://ui-avatars.com/api/?name={{ u.username }}&background=random&size=128" class="user-avatar-large" alt="Profile">
                {% endif %}
            </div>
            <div>
                <h2 class="mb-0 fw-bold">{{ u.username }}</h2>
                <div class="opacity-75 mb-2">{{ u.email }}</div>
                <div class="d-flex gap-2">
                    <span class="badge bg-light text-dark border">{{ u.unique_id }}</span>
                    <span class="badge bg-warning text-dark">{{ u.mess_type }} Mess</span>
                </div>
            </div>
            <div class="ms-auto text-end">
                <div class="opacity-75 text-uppercase small">Current Balance</div>
                <div class="display-6 fw-bold">₹{{ u.balance }}</div>
            </div>
        </div>
    </div>

    <ul class="nav nav-tabs mb-4" id="userTabs" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#attendanceTab">
                <i class="bi bi-calendar-check me-2"></i>Attendance History
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#subsTab">
                <i class="bi bi-credit-card-2-back me-2"></i>Subscription History
            </button>
        </li>
    </ul>

    <div class="tab-content" id="userTabsContent">
        
        <div class="tab-pane fade show active" id="attendanceTab">
            <div class="card shadow-sm border-0">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="ps-4">Date & Time</th>
                                    <th>Meal Type</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for a in attendance %}
                                <tr>
                                    <td class="ps-4">{{ to_ist(a.timestamp) }}</td>
                                    <td>
                                        {% if a.meal_type == 'Lunch' %}
                                            <span class="badge bg-warning text-dark"><i class="bi bi-sun-fill"></i> Lunch</span>
                                        {% else %}
                                            <span class="badge bg-primary"><i class="bi bi-moon-stars-fill"></i> Dinner</span>
                                        {% endif %}
                                    </td>
                                    <td><span class="text-success"><i class="bi bi-check-circle-fill"></i> Consumed</span></td>
                                </tr>
                                {% else %}
                                <tr><td colspan="3" class="text-center py-4 text-muted">No attendance records found.</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="subsTab">
            <div class="card shadow-sm border-0">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="ps-4">Date</th>
                                    <th>Amount</th>
                                    <th>Transaction ID</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for p in payments %}
                                <tr>
                                    <td class="ps-4">{{ p.timestamp.strftime('%d %b %Y, %I:%M %p') }}</td>
                                    <td class="fw-bold text-success">₹{{ p.amount }}</td>
                                    <td><span class="font-monospace bg-light border px-2 py-1 rounded">{{ p.transaction_id }}</span></td>
                                    <td>
                                        {% if p.status == 'Approved' %}
                                            <span class="badge bg-success">Approved</span>
                                        {% elif p.status == 'Pending' %}
                                            <span class="badge bg-warning text-dark">Pending</span>
                                        {% else %}
                                            <span class="badge bg-danger">Rejected</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% else %}
                                <tr><td colspan="4" class="text-center py-4 text-muted">No subscription history found.</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}