{% extends "base.html" %}

{% block content %}
<div class="container py-5">
    <div class="card mx-auto shadow" style="max-width: 600px;">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Update Profile</h4>
        </div>
        <div class="card-body p-4">
            
            <form method="POST" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <div class="text-center mb-4">
                    {% if u.image_filename %}
                        {% if 'http' in u.image_filename %}
                            <img src="{{ u.image_filename }}" class="rounded-circle mb-2" style="width: 100px; height: 100px; object-fit: cover; border: 3px solid #dee2e6;">
                        {% else %}
                            <img src="{{ url_for('static', filename='profile_pics/' + u.image_filename) }}" class="rounded-circle mb-2" style="width: 100px; height: 100px; object-fit: cover; border: 3px solid #dee2e6;">
                        {% endif %}
                    {% endif %}
                    <div>
                        <label class="form-label small text-muted">Change Profile Photo</label>
                        <input name="image" type="file" class="form-control form-control-sm mx-auto" style="max-width: 300px;">
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Full Name</label>
                    <input name="name" class="form-control" value="{{ u.name or '' }}" placeholder="Enter full name" required>
                </div>

                <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Username</label>
                        <input name="username" class="form-control" value="{{ u.username }}" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Phone Number</label>
                        <input name="phone" type="tel" class="form-control" value="{{ u.phone or '' }}" 
                               pattern="[0-9]{10}" title="Please enter exactly 10 digits" placeholder="10-digit number" required>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Email</label>
                    <input name="email" type="email" class="form-control" value="{{ u.email }}" required>
                </div>

                <div class="mb-4">
                    <label class="form-label fw-bold">New Password <small class="text-muted fw-normal">(Leave blank to keep current)</small></label>
                    <input name="password" type="password" class="form-control" placeholder="Enter new password">
                </div>

                <div class="d-grid gap-2">
                    <button class="btn btn-success fw-bold">Save Changes</button>
                    <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-secondary">Cancel</a>
                </div>
            </form>

            <hr class="my-4">

            <div class="text-center">
                <p class="text-danger small fw-bold text-uppercase mb-2">Danger Zone</p>
                <form method="POST" action="{{ url_for('main.delete_account') }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button class="btn btn-outline-danger btn-sm" onclick="return confirm('Are you sure you want to delete your account permanently? This cannot be undone.')">
                        <i class="bi bi-trash"></i> Delete Account Permanently
                    </button>
                </form>
            </div>

        </div>
    </div>
</div>
{% endblock %}