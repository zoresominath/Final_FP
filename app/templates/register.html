{% extends "base.html" %}

{% block title %}Register - Bachelor's Kitchen{% endblock %}

{% block content %}
<style>
    /* Yellow/Gold Gradient Title Style */
    .mess-title-yellow {
        background: -webkit-linear-gradient(45deg, #FFD700, #ff8c00);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        font-family: 'Lobster', cursive;
        font-weight: bold;
        font-size: 3rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }
</style>

<div class="d-flex align-items-center justify-content-center py-5 w-100" style="min-height: 100vh;">
    <div class="col-md-6">
        <div class="card p-5 border-0 shadow-sm" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);">
            
            <div class="text-center mb-4">
                <h1 class="mess-title-yellow mb-0">Bachelor's Kitchen</h1>
                <p class="text-muted">Create your account</p>
            </div>
            
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <form method="POST" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <div class="mb-3">
                    <input name="name" class="form-control" placeholder="Full Name" required 
                           value="{{ request.form.get('name', '') }}">
                </div>

                <div class="row g-2 mb-3">
                    <div class="col-md-6">
                        <input name="username" class="form-control" placeholder="Username" required
                               value="{{ request.form.get('username', '') }}">
                    </div>
                    <div class="col-md-6">
                        <input name="phone" class="form-control" type="tel" placeholder="Phone (10 digits)" 
                               pattern="[0-9]{10}" title="Please enter exactly 10 digits" required
                               value="{{ request.form.get('phone', '') }}">
                    </div>
                </div>

                <div class="row g-2 mb-3">
                    <div class="col-md-6">
                        <input name="email" class="form-control" type="email" placeholder="Email" required
                               value="{{ request.form.get('email', '') }}">
                    </div>
                    <div class="col-md-6">
                        <input name="dob" class="form-control" type="date" required title="Date of Birth"
                               value="{{ request.form.get('dob', '') }}">
                    </div>
                </div>

                <div class="row g-2 mb-3">
                    <div class="col-md-6">
                        <select name="gender" class="form-select" required>
                            <option value="" disabled {% if not request.form.get('gender') %}selected{% endif %}>Select Gender</option>
                            <option value="Male" {% if request.form.get('gender') == 'Male' %}selected{% endif %}>Male</option>
                            <option value="Female" {% if request.form.get('gender') == 'Female' %}selected{% endif %}>Female</option>
                            <option value="Other" {% if request.form.get('gender') == 'Other' %}selected{% endif %}>Other</option>
                        </select>
                    </div>
                    
                    <div class="col-md-6">
                        <select name="mess_type" class="form-select" required>
                            <option value="" disabled {% if not request.form.get('mess_type') %}selected{% endif %}>Select Mess Plan</option>
                            <option value="Two Time" {% if request.form.get('mess_type') == 'Two Time' %}selected{% endif %}>Two Time (Lunch & Dinner)</option>
                            <option value="One Time" {% if request.form.get('mess_type') == 'One Time' %}selected{% endif %}>One Time (Any 1 Meal/Day)</option>
                        </select>
                    </div>
                </div>

                <div class="mb-3">
                    <input name="password" type="password" class="form-control" placeholder="Password (Min 8 chars)" required>
                </div>

                <div class="mb-3">
                    <label class="form-label text-muted small">Profile Photo</label>
                    <input name="image" type="file" class="form-control" accept="image/*">
                </div>

                <div class="mb-3">
                    <input name="admin_code" type="password" class="form-control" placeholder="Admin Code (Optional)">
                </div>

                <button class="btn btn-primary w-100 py-2 fw-bold shadow-sm">Register</button>
            </form>
            
            <div class="text-center mt-3">
                <a href="{{ url_for('main.login') }}" class="text-decoration-none">Already have an account? Login</a>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Date restriction logic
        var today = new Date();
        today.setDate(today.getDate() - 1);
        var dd = String(today.getDate()).padStart(2, '0');
        var mm = String(today.getMonth() + 1).padStart(2, '0'); 
        var yyyy = today.getFullYear();
        var maxDate = yyyy + '-' + mm + '-' + dd;
        
        var dobInput = document.querySelector('input[name="dob"]');
        if (dobInput) {
            dobInput.setAttribute("max", maxDate);
        }
    });
</script>

{% endblock %}